<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/an-old-hope.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/benchmark@2.1.4/benchmark.min.js" defer></script>
  <script src="gobo.js" defer></script>
  <script src="main.js" defer></script>
  <title>Baduk JS - Step By Step</title>
</head>

<body>
  <header>
    <h1>Baduk JS - Step By Step</h1>
    <p>Experiments in Baduk/Game of Go/Weiqi using JavaScript</p>
  </header>
  <main>
    <aside>
      <nav>
        <a href="#Introduction">Introduction</a>
        <a href="#TheVisionAhead">The Vision Ahead</a>
        <a href="#TheFirstStep">The First Step</a>
        <a href="#Rules">Rules of the Game</a>
        <a href="#FloodFill">Flood Fill</a>
        <a href="#LibertyCount">Liberty Count</a>
        <a href="#Scoring">Scoring</a>
        <a href="#UnitTests">Unit Tests</a>
        <a href="#Rollouts">Rollouts</a>
      </nav>
    </aside>
    <h2 id="Introduction"><a href="#Introduction">Introduction</a></h2>
    <p>This page intends to demonstrate a series of small steps that all together will reach a more distant goal.</p>
    <p>Writing a large program can be a daunting task. Even if the end goal is clearly envisioned, the steps to get
      there might be only somewhat understood in advance. Many times the path forward must be discovered one step at a
      time.</p>
    <p>I have the goal of writing a <i>reasonably</i> performing Monte Carlo Tree Search (MCTS) bot for playing the Game
      of Go. I'm going to write it all in JavaScript.</p>
    <p>In order to avoid burnout along the way, I will be dividing up the large size task into many small steps. Each of
      the sections below will focus on one of those small steps.</p>
    <p>This page is a <i>living document</i> and will be updated as I write more sections ...</p>
    <section>
      <h2 id="TheVisionAhead"><a href="#TheVisionAhead">The Vision Ahead</a></h2>
      <p>I want to pick a medium sized goal to directly plan towards.
        I know that an MCTS bot will need to enact the <i>rules of the game</i> in order to perform automated Rollouts.
        It will also need a way to score a <b>finished game</b> for counting Rollout wins and losses.</p>
      <p>The file <code>liberty_score.txt</code> contains my vision for the minimum abilities a computer would need to
        enforce the rules of Go.</p>
      <ol>
        <li><mark>Count Liberties</mark></li>
        <li><mark>Score a Finished Board</mark></li>
      </ol>
      <details>
        <summary>liberty_score.txt</summary>
        <pre><code preload-txt data-url="liberty_score.txt"></code></pre>
      </details>
      <p>The text file is written so a human can read it. It's also carefully formatted so it can be read into a
        script and parsed into a set of Unit Tests.</p>
      <p>The next section will start on the path to loading, parsing and <i>eventually</i> executing the Unit Tests in
        this file.</p>
    </section>
    <section>
      <h2 id="TheFirstStep"><a href="#TheFirstStep">The First Step</a></h2>
      <p>Before we tackle <code>liberty_score.txt</code> let's start with something less complicated.
        The first step is reading a text file with an example position from a 7x7 board.
        It will be easier to parse because it only has a single board and has no extra headers, comments, or trailing
        whitespace.
        The overall structure of <code>board7x7.txt</code> is as simple as we can make it while still being a meaningful
        first step.
      </p>
      <pre><summary>board7x7.txt</summary><code preload-txt data-url="board7x7.txt"></code></pre>
      <p>We can add coordinate labels for both axes while we're parsing the board.
        Let's also restore the whitespace between the columns.</p>
      <details>
        <summary>board7x7.js</summary>
        <pre><code preload-javascript data-url="board7x7.js"></code></pre>
      </details>
      <script src="board7x7.js" defer></script>
      <div data-url="board7x7.txt" run="board7x7">
        <button run>Run</button> <button time>Time</button> <mark hidden></mark>
        <pre><summary>output</summary><code output></code></pre>
      </div>
    </section>
    <section>
      <h2 id="Rules"><a href="#Rules">Rules of the Game</a></h2>
      <p>Here's a quick refresher on the rules of Go:</p>
      <ul>
        <li>Starting with Black, players takes turns placing a single stone on the board.</li>
        <li>If a stone is placed so that an opponent chain has no liberties, that chain is captured.</li>
        <li>(After the capture rule is applied) the placed stone must have or share at least one liberty.</li>
        <li>It is prohibited to place a stone that repeats a previous board state.</li>
      </ul>
    </section>
    <section>
      <h2 id="FloodFill"><a href="#FloodFill">Flood Fill</a></h2>
      <p>Now that we feel comfortable <i>parsing</i> the text board we can look ahead to processing the board for more
        details.</p>
      <p>To reach our medium goal we need to "count liberties" and "score the game". Scoring the game further relies on
        identifying "enclosed empty spots" and which stone colour they "belong to".</p>
      <ol>
        <li><mark>Count Liberties</mark>
          <ul>
            <li>Follow a chain of same-colour stones.</li>
            <li>Count all the adjacent empty spots.</li>
          </ul>
        </li>
        <li><mark>Enclosed Empty Spots</mark>
          <ul>
            <li>Follow a chain of empty spots.</li>
            <li>Identify the adjacent stone colours.</li>
          </ul>
        </li>
      </ol>
      <p>Both of these abilities rely on an even smaller ability. We need to be able to follow "chains" of
        same-type pieces on the board. I know from experience that trying to do this task by "scanning" is possible
        but very time consuming. The efficient approach here is to use Flood Fill (aka DFS, Depth First Search)</p>
      <p>The scenario in <code>flood7x7.txt</code> challenges us to handle several issues.</p>
      <ul>
        <li>Follow the chain of stones through several branching points.</li>
        <li>Avoid an infinite loop following the circular path of stones.</li>
        <li>Avoid re-counting adjacent empty spots from multiple angles.</li>
      </ul>
      <pre><summary>flood7x7.txt</summary><code preload-txt data-url="flood7x7.txt"></code></pre>
      <p>Let's count the number stones in the black chain and the number of liberties it's touching.
        We'll also show the number of <i>visits</i> at each location of the board during our Flood Fill.</p>
      <details>
        <summary>flood7x7.js</summary>
        <pre><code preload-javascript data-url="flood7x7.js"></code></pre>
      </details>
      <script src="flood7x7.js" defer></script>
      <div data-url="flood7x7.txt" run="flood7x7">
        <button run>Run</button> <button time>Time</button> <mark hidden></mark>
        <pre><summary>output</summary><code output></code></pre>
      </div>
    </section>
    <section>
      <h2 id="LibertyCount"><a href="#LibertyCount">Liberty Count</a></h2>
      <p>At this point we have all of the pieces we need to calculate Liberties and Score.
        To get Liberty Counts for the whole board we only need to run Flood Fill for each stone.</p>
      <pre><summary>board7x7.txt</summary><code preload-txt data-url="board7x7.txt"></code></pre>
      <details>
        <summary>liberty7x7.js</summary>
        <pre><code preload-javascript data-url="liberty7x7.js"></code></pre>
      </details>
      <script src="liberty7x7.js" defer></script>
      <div data-url="board7x7.txt" run="liberty7x7">
        <button run>Run</button> <button time>Time</button> <mark hidden></mark>
        <pre><summary>output</summary><code output></code></pre>
      </div>
    </section>
    <section>
      <h2 id="Scoring"><a href="#Scoring">Scoring</a></h2>
      <p>Scoring is very similar to Counting Liberties with these differences:</p>
      <ul>
        <li>Follow empty spots instead of stones.</li>
        <li>Identify the <i>types</i> of adjacent stones instead of summing them up.</li>
      </ul>
      <div>
        <pre><summary>board7x7.txt</summary><code preload-txt data-url="board7x7.txt"></code></pre>
      </div>
      <p>We'll need to scan the board for stones but not follow them,
        and follow empty spots as we find them.
      </p>
      <details>
        <summary>score7x7.js</summary>
        <pre><code preload-javascript data-url="score7x7.js"></code></pre>
      </details>
      <script src="score7x7.js" defer></script>
      <div data-url="board7x7.txt" run="score7x7">
        <button run>Run</button> <button time>Time</button> <mark hidden></mark>
        <pre><summary>output</summary><code output></code></pre>
      </div>
    </section>
    <section>
      <h2 id="UnitTests"><a href="#UnitTests">Unit Tests</a></h2>
      <p>We have enough code now to solve all the unit tests in <code>liberty_score.txt</code>.
        But we still need to extract the tests from the text file and verify the outputs.</p>
      <details>
        <summary>liberty_score.txt</summary>
        <pre><code preload-txt data-url="liberty_score.txt"></code></pre>
      </details>
      <p>Let's start by extracting the input/output boards:</p>
      <ul>
        <li><mark>Liberty Count</mark>
          <ul>
            <li>1 input board</li>
            <li>1 output board</li>
          </ul>
        </li>
        <li><mark>Enclosed Score</mark>
          <ul>
            <li>1 input board</li>
            <li>2 output boards</li>
            <li><code>key:val</code> pairs</li>
          </ul>
        </li>
      </ul>
      <details>
        <summary>extract_tests.js</summary>
        <pre><code preload-javascript data-url="extract_tests.js"></code></pre>
      </details>
      <script src="extract_tests.js" defer></script>
      <div data-url="liberty_score.txt" run="extract_tests">
        <button run>Run</button> <button time>Time</button> <mark hidden></mark>
        <pre><summary>output</summary><code output></code></pre>
      </div>
      <p>We now have the full extraction of the Unit Tests.
        With tests in hand we can verify the correctness of our previous functions.</p>
      <details>
        <summary>test7x7.js</summary>
        <pre><code preload-javascript data-url="test7x7.js"></code></pre>
      </details>
      <script src="test7x7.js" defer></script>
      <div data-url="liberty_score.txt" run="test7x7">
        <button run>Run</button> <button time>Time</button> <mark hidden></mark>
        <pre><summary>output</summary><code output></code></pre>
      </div>
    </section>
    <section>
      <h2 id="Rollouts"><a href="#Rollouts">Rollouts</a></h2>
      <p>Rollouts are the repeated action of adding stones to the board.
        For most of the Rollout the stone colour will strictly alternate.
        Near the end of the Rollout, one colour may need to pass (skip turn) before the other has run out of moves.
        Depending on captures, the colour that needs to pass may change hands several times.</p>
      <p>Key abilities needed for Rollouts:</p>
      <ul>
        <li><mark>State</mark><br>
          Keep a copy of the board position and modify it when a stone is played.
        </li>
        <li><mark>Captures</mark><br>
          Remove chains starved of liberties after a move.
        </li>
        <li><mark>Legal Move</mark><br>
          Is a board position still valid after playing a stone and possible captures?
        </li>
      </ul>
      <details>
        <summary>rollout7x7.js</summary>
        <pre><code preload-javascript data-url="rollout7x7.js"></code></pre>
      </details>
      <script src="rollout7x7.js" defer></script>
      <div data-id="rollout7x7" run="rollout7x7">
        <div>
          <button run>Run</button> <button time>Time</button> <mark hidden></mark>
        </div>
        <div class="goban" size="7" id="rollout7x7_goban"></div>
        <pre><summary>input/output</summary><code output id="rollout7x7"></code></pre>
      </div>

    </section>

  </main>
  <footer>
    <p>by <a href="https://lazymammal.github.io/">LazyMammal</a></p>
  </footer>
</body>

</html>